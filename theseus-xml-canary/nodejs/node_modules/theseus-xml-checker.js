xml2js = require("xml2js");


async function checkXML(xmlString, expectedRxList) {
    var parser =new  xml2js.Parser();
    const data = await parser.parseStringPromise(xmlString).catch(err => {throw(err)});

    console.log(JSON.stringify(data));

    if (!data.receivers || !data.receivers.receiver) {
        data.receivers.receiver=[];
    }

    var rxids = data.receivers.receiver.map(rx=>rx.$.name).sort();
    var rxidsString = rxids.toString();
    var expectedRxs = expectedRxList.split(",");

    var rxPresent = expectedRxs.map(expRxid => ({
        "rxid": expRxid, 
        "present": rxids.indexOf(expRxid) > -1
    }));

    /*if (rxids === expectedRxList) {
        return true;
    }
    else
    {
        throw ("Missing receivers!");
    }*/
    return rxPresent;

}

module.exports = {checkXML};